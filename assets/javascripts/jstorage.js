/*
 * ----------------------------- JSTORAGE -------------------------------------
 * Simple local storage wrapper to save data on the browser side, supporting
 * all major browsers - IE6+, Firefox2+, Safari4+, Chrome4+ and Opera 10.5+
 *
 * Author: Andris Reinman, andris.reinman@gmail.com
 * Project homepage: www.jstorage.info
 *
 * Licensed under Unlicense:
 *
 * This is free and unencumbered software released into the public domain.
 *
 * Anyone is free to copy, modify, publish, use, compile, sell, or
 * distribute this software, either in source code form or as a compiled
 * binary, for any purpose, commercial or non-commercial, and by any
 * means.
 *
 * In jurisdictions that recognize copyright laws, the author or authors
 * of this software dedicate any and all copyright interest in the
 * software to the public domain. We make this dedication for the benefit
 * of the public at large and to the detriment of our heirs and
 * successors. We intend this dedication to be an overt act of
 * relinquishment in perpetuity of all present and future rights to this
 * software under copyright law.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
 * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * For more information, please refer to <http://unlicense.org/>
 */
!function(){"use strict";function e(){var e=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),e=!0,window.localStorage.removeItem("_tmptest")}catch(a){}if(e)try{window.localStorage&&(k=window.localStorage,T="localStorage",b=k.jStorage_update)}catch(r){}else if("globalStorage"in window)try{window.globalStorage&&(k="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],T="globalStorage",b=k.jStorage_update)}catch(s){}else{if(D=document.createElement("link"),!D.addBehavior)return void(D=null);D.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(D);try{D.load("jStorage")}catch(i){D.setAttribute("jStorage","{}"),D.save("jStorage"),D.load("jStorage")}var _="{}";try{_=D.getAttribute("jStorage")}catch(o){}try{b=D.getAttribute("jStorage_update")}catch(l){}k.jStorage=_,T="userDataBehavior"}d(),m(),t(),u(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&n()},!1)}function a(){var e="{}";if("userDataBehavior"==T){D.load("jStorage");try{e=D.getAttribute("jStorage")}catch(a){}try{b=D.getAttribute("jStorage_update")}catch(t){}k.jStorage=e}d(),m(),u()}function t(){"localStorage"==T||"globalStorage"==T?"addEventListener"in window?window.addEventListener("storage",n,!1):document.attachEvent("onstorage",n):"userDataBehavior"==T&&setInterval(n,1e3)}function n(){var e;clearTimeout(w),w=setTimeout(function(){if("localStorage"==T||"globalStorage"==T)e=k.jStorage_update;else if("userDataBehavior"==T){D.load("jStorage");try{e=D.getAttribute("jStorage_update")}catch(a){}}e&&e!=b&&(b=e,r())},25)}function r(){var e,t=y.parse(y.stringify(p.__jstorage_meta.CRC32));a(),e=y.parse(y.stringify(p.__jstorage_meta.CRC32));var n,r=[],i=[];for(n in t)if(t.hasOwnProperty(n)){if(!e[n]){i.push(n);continue}t[n]!=e[n]&&"2."==String(t[n]).substr(0,2)&&r.push(n)}for(n in e)e.hasOwnProperty(n)&&(t[n]||r.push(n));s(r,"updated"),s(i,"deleted")}function s(e,a){e=[].concat(e||[]);var t,n,r,s;if("flushed"==a){e=[];for(var i in A)A.hasOwnProperty(i)&&e.push(i);a="deleted"}for(t=0,r=e.length;r>t;t++){if(A[e[t]])for(n=0,s=A[e[t]].length;s>n;n++)A[e[t]][n](e[t],a);if(A["*"])for(n=0,s=A["*"].length;s>n;n++)A["*"][n](e[t],a)}}function i(){var e=(+new Date).toString();if("localStorage"==T||"globalStorage"==T)try{k.jStorage_update=e}catch(a){T=!1}else"userDataBehavior"==T&&(D.setAttribute("jStorage_update",e),D.save("jStorage"));n()}function d(){if(k.jStorage)try{p=y.parse(String(k.jStorage))}catch(e){k.jStorage="{}"}else k.jStorage="{}";g=k.jStorage?String(k.jStorage).length:0,p.__jstorage_meta||(p.__jstorage_meta={}),p.__jstorage_meta.CRC32||(p.__jstorage_meta.CRC32={})}function _(){c();try{k.jStorage=y.stringify(p),D&&(D.setAttribute("jStorage",k.jStorage),D.save("jStorage")),g=k.jStorage?String(k.jStorage).length:0}catch(e){}}function o(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==e)throw new TypeError("Reserved key name");return!0}function m(){var e,a,t,n,r=1/0,d=!1,o=[];if(clearTimeout(f),p.__jstorage_meta&&"object"==typeof p.__jstorage_meta.TTL){e=+new Date,t=p.__jstorage_meta.TTL,n=p.__jstorage_meta.CRC32;for(a in t)t.hasOwnProperty(a)&&(t[a]<=e?(delete t[a],delete n[a],delete p[a],d=!0,o.push(a)):t[a]<r&&(r=t[a]));1/0!=r&&(f=setTimeout(m,Math.min(r-e,2147483647))),d&&(_(),i(),s(o,"deleted"))}}function u(){var e,a;if(p.__jstorage_meta.PubSub){var t,n=v,r=[];for(e=a=p.__jstorage_meta.PubSub.length-1;e>=0;e--)t=p.__jstorage_meta.PubSub[e],t[0]>v&&(n=t[0],r.unshift(t));for(e=r.length-1;e>=0;e--)l(r[e][1],r[e][2]);v=n}}function l(e,a){if(S[e])for(var t=0,n=S[e].length;n>t;t++)try{S[e][t](e,y.parse(y.stringify(a)))}catch(r){}}function c(){if(p.__jstorage_meta.PubSub){for(var e=+new Date-2e3,a=0,t=p.__jstorage_meta.PubSub.length;t>a;a++)if(p.__jstorage_meta.PubSub[a][0]<=e){p.__jstorage_meta.PubSub.splice(a,p.__jstorage_meta.PubSub.length-a);break}p.__jstorage_meta.PubSub.length||delete p.__jstorage_meta.PubSub}}function M(e,a){p.__jstorage_meta||(p.__jstorage_meta={}),p.__jstorage_meta.PubSub||(p.__jstorage_meta.PubSub=[]),p.__jstorage_meta.PubSub.unshift([+new Date,e,a]),_(),i()}function h(e,a){for(var t,n=e.length,r=a^n,s=0;n>=4;)t=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24,t=1540483477*(65535&t)+((1540483477*(t>>>16)&65535)<<16),t^=t>>>24,t=1540483477*(65535&t)+((1540483477*(t>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^t,n-=4,++s;switch(n){case 3:r^=(255&e.charCodeAt(s+2))<<16;case 2:r^=(255&e.charCodeAt(s+1))<<8;case 1:r^=255&e.charCodeAt(s),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)}return r^=r>>>13,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),r^=r>>>15,r>>>0}var L="0.4.12",Y=window.jQuery||window.$||(window.$={}),y={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(e){return String(e).evalJSON()}||Y.parseJSON||Y.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||Y.toJSON};if("function"!=typeof y.parse||"function"!=typeof y.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var f,p={__jstorage_meta:{CRC32:{}}},k={jStorage:"{}"},D=null,g=0,T=!1,A={},w=!1,b=0,S={},v=+new Date,H={isXML:function(e){var a=(e?e.ownerDocument||e:0).documentElement;return a?"HTML"!==a.nodeName:!1},encode:function(e){if(!this.isXML(e))return!1;try{return(new XMLSerializer).serializeToString(e)}catch(a){try{return e.xml}catch(t){}}return!1},decode:function(e){var a,t="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(e){var a=new ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(e),a};return t?(a=t.call("DOMParser"in window&&new DOMParser||window,e,"text/xml"),this.isXML(a)?a:!1):!1}};Y.jStorage={version:L,set:function(e,a,t){if(o(e),t=t||{},"undefined"==typeof a)return this.deleteKey(e),a;if(H.isXML(a))a={_is_xml:!0,xml:H.encode(a)};else{if("function"==typeof a)return void 0;a&&"object"==typeof a&&(a=y.parse(y.stringify(a)))}return p[e]=a,p.__jstorage_meta.CRC32[e]="2."+h(y.stringify(a),2538058380),this.setTTL(e,t.TTL||0),s(e,"updated"),a},get:function(e,a){return o(e),e in p?p[e]&&"object"==typeof p[e]&&p[e]._is_xml?H.decode(p[e].xml):p[e]:"undefined"==typeof a?null:a},deleteKey:function(e){return o(e),e in p?(delete p[e],"object"==typeof p.__jstorage_meta.TTL&&e in p.__jstorage_meta.TTL&&delete p.__jstorage_meta.TTL[e],delete p.__jstorage_meta.CRC32[e],_(),i(),s(e,"deleted"),!0):!1},setTTL:function(e,a){var t=+new Date;return o(e),a=Number(a)||0,e in p?(p.__jstorage_meta.TTL||(p.__jstorage_meta.TTL={}),a>0?p.__jstorage_meta.TTL[e]=t+a:delete p.__jstorage_meta.TTL[e],_(),m(),i(),!0):!1},getTTL:function(e){var a,t=+new Date;return o(e),e in p&&p.__jstorage_meta.TTL&&p.__jstorage_meta.TTL[e]?(a=p.__jstorage_meta.TTL[e]-t,a||0):0},flush:function(){return p={__jstorage_meta:{CRC32:{}}},_(),i(),s(null,"flushed"),!0},storageObj:function(){function e(){}return e.prototype=p,new e},index:function(){var e,a=[];for(e in p)p.hasOwnProperty(e)&&"__jstorage_meta"!=e&&a.push(e);return a},storageSize:function(){return g},currentBackend:function(){return T},storageAvailable:function(){return!!T},listenKeyChange:function(e,a){o(e),A[e]||(A[e]=[]),A[e].push(a)},stopListening:function(e,a){if(o(e),A[e]){if(!a)return void delete A[e];for(var t=A[e].length-1;t>=0;t--)A[e][t]==a&&A[e].splice(t,1)}},subscribe:function(e,a){if(e=(e||"").toString(),!e)throw new TypeError("Channel not defined");S[e]||(S[e]=[]),S[e].push(a)},publish:function(e,a){if(e=(e||"").toString(),!e)throw new TypeError("Channel not defined");M(e,a)},reInit:function(){a()},noConflict:function(e){return delete window.$.jStorage,e&&(window.jStorage=this),this}},e()}();